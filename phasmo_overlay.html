<!DOCTYPE html>
<html>
    <head>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Handlee&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
        <title>Phasmophobia Stream Overlay</title>
       
        <style>
            #GhostSelect, #ItemSelect, #ExtraSelect {
                height: max-content;
                width: 400px;
                background-color: gray;
                display: flex;
                align-items: flex-start;
                flex-wrap: wrap;
                margin-bottom: 20px;
                user-select: none;
            }
            .item {
                width: 30%;
                height: 1.5em;
                font-size: 15px;
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 1.5%;
                cursor: pointer;
                background-color: inherit;
                font-family: "Handlee", cursive;
                font-weight: 400;
                text-decoration-color: red;
                text-shadow: 2px 2px black;
            } 
            .extra:nth-of-type(6):hover, 
            .extra:nth-of-type(5):hover { filter: none !important; cursor: auto !important; }
            .item:hover { filter:brightness(90%); }
            p { color: #e0b255; }

            .state-minus { color: white; text-decoration: none; }
            .state-x, .state-y { background-color: #3b3b3b; color: gray; }
            .state-o { box-shadow: 1px 1px black, -1px 1px black, 1px -1px black, -1px -1px black; border-radius: 50%; }
        </style>
    </head>
    <body>

        <script>
            let crossed_ghosts = [];
            let crossed_evidence = [];
            let found_ghost = null;
            let found_evidence = [];
            let isMale = false;
            let evidence_amount = 3;
            let timer_state = "o";
            let timestamp = Math.floor((new Date()).getTime() / 1000);
            let timer_value = 0;
            let speed_option = 0;

            const ghost_data = {
                "Banshee": {
                    "Evidence": ["Ghost Orbs", "Ultraviolet", "D.O.T.S"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
                "Dayan": {
                    "Evidence": ["EMF5", "Ghost Orbs", "Spirit Box"],
                    "Forced": null,
                    "Speed": ["Slow Speed", "Fast Speed"],
                },
                "Deogen": {
                    "Evidence": ["Spirit Box", "Ghost Writing", "D.O.T.S"],
                    "Forced": "Spirit Box",
                    "Speed": null,
                },
                "Demon": {
                    "Evidence": ["Freezing Temps", "Ultraviolet", "Ghost Writing"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
                "Gallu": {
                    "Evidence": ["EMF5", "Spirit Box", "Ultraviolet"],
                    "Forced": null,
                    "Speed": ["Slow Speed", "Fast Speed"],
                },
                "Goryo": {
                    "Evidence": ["EMF5", "Ultraviolet", "D.O.T.S"],
                    "Forced": "D.O.T.S",
                    "Speed": ["Normal Speed"],
                },
                "Hantu": {
                    "Evidence": ["Freezing Temps", "Ghost Orbs", "Ultraviolet"],
                    "Forced": "Freezing Temps",
                    "Speed": ["Slow Speed", "Fast Speed"],
                },
                "Jinn": {
                    "Evidence": ["EMF5", "Freezing Temps", "Ultraviolet"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
                "Mare": {
                    "Evidence": ["Ghost Orbs", "Spirit Box", "Ghost Writing"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
                "Moroi": {
                    "Evidence": ["Spirit Box", "Freezing Temps", "Ghost Writing"],
                    "Forced": "Spirit Box",
                    "Speed": null,
                },
                "Myling": {
                    "Evidence": ["EMF5", "Ultraviolet", "Ghost Writing"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
                "Obake": {
                    "Evidence": ["EMF5", "Ghost Orbs", "Ultraviolet"],
                    "Forced": "Ultraviolet",
                    "Speed": ["Normal Speed"],
                },
                "Obambo": {
                    "Evidence": ["D.O.T.S", "Ultraviolet", "Ghost Writing"],
                    "Forced": null,
                    "Speed": ["Slow Speed", "Fast Speed"],
                },
                "Oni": {
                    "Evidence": ["EMF5", "Freezing Temps", "D.O.T.S"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
                "Onryo": {
                    "Evidence": ["Ghost Orbs", "Spirit Box", "Freezing Temps"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
                "Phantom": {
                    "Evidence": ["Spirit Box", "Ultraviolet", "D.O.T.S"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
                "Poltergeist": {
                    "Evidence": ["Spirit Box", "Ultraviolet", "Ghost Writing"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
                "Raiju": {
                    "Evidence": ["EMF5", "Ghost Orbs", "D.O.T.S"],
                    "Forced": null,
                    "Speed": ["Slow Speed", "Fast Speed"],
                },
                "Revenant": {
                    "Evidence": ["Ghost Orbs", "Freezing Temps", "Ghost Writing"],
                    "Forced": null,
                    "Speed": ["Slow Speed"],
                },
                "Shade": {
                    "Evidence": ["EMF5", "Freezing Temps", "Ghost Writing"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
                "Spirit": {
                    "Evidence": ["EMF5", "Spirit Box", "Ghost Writing"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
                "Thaye": {
                    "Evidence": ["Ghost Orbs", "D.O.T.S", "Ghost Writing"],
                    "Forced": null,
                    "Speed": null,
                },
                "The Mimic": {
                    "Evidence": ["Spirit Box", "Freezing Temps", "Ultraviolet"],
                    "Forced": "Ghost Orbs",
                    "Speed": null,
                },
                "The Twins": {
                    "Evidence": ["EMF5", "Spirit Box", "Freezing Temps"],
                    "Forced": null,
                    "Speed": null,
                },
                "Wraith": {
                    "Evidence": ["EMF5", "Spirit Box", "D.O.T.S"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
                "Yokai": {
                    "Evidence": ["Ghost Orbs", "Spirit Box", "D.O.T.S"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
                "Yurei": {
                    "Evidence": ["Ghost Orbs", "Freezing Temps", "D.O.T.S"],
                    "Forced": null,
                    "Speed": ["Normal Speed"],
                },
            }
        </script>

        <div id="ItemSelect"> 
            <div class="evidence item" onclick="mark_evidence(this)" data-symbol="-">EMF5</div>
            <div class="evidence item" onclick="mark_evidence(this)" data-symbol="-">Ghost Orbs</div>
            <div class="evidence item" onclick="mark_evidence(this)" data-symbol="-">Spirit Box</div>
            <div class="evidence item" onclick="mark_evidence(this)" data-symbol="-">Freezing Temps</div>
            <div class="evidence item" onclick="mark_evidence(this)" data-symbol="-">Ultraviolet</div>
            <div class="evidence item" onclick="mark_evidence(this)" data-symbol="-">Ghost Writing</div>
            <div class="evidence item" onclick="mark_evidence(this)" data-symbol="-">D.O.T.S</div>
        </div>
        
        <div id="GhostSelect">
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Banshee<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Dayan<p>&nbsp;(45-65)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Deogen<p>&nbsp;(40)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Demon<p>&nbsp;(70)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Gallu<p>&nbsp;(40-60)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Goryo<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Hantu<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Jinn<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Mare<p>&nbsp;(40-60)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Moroi<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Myling<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Obake<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Obambo<p>&nbsp;(10-65)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Oni<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Onryo<p>&nbsp;(40-60)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Phantom<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Poltergeist<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Raiju<p>&nbsp;(50-65)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Revenant<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Shade<p>&nbsp;(0-35)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Spirit<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Thaye<p>&nbsp;(15-75)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">The Mimic<p>&nbsp;(?)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">The Twins<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Wraith<p>&nbsp;(50)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Yokai<p>&nbsp;(50-80)</p></div>
            <div class="ghost item" onclick="mark_ghost(this)" data-symbol="-">Yurei<p>&nbsp;(50)</p></div>
        </div>

        <div id="ExtraSelect">
            <div class="extra item" onclick="isMale = !isMale; applyData();" data-symbol="-">Male Ghost</div>
            <div class="extra item" onclick="toggleEvidence()" data-symbol="-">3 Evidence</div>
            <div class="extra item" ondblclick="window.location.reload()" data-symbol="-">Reset</div>
            <div class="extra item" id="TimeStart" onclick="" data-symbol="o">Start</div>
            <div class="extra item" id="Timer" data-symbol="-" style="font-family: 'Roboto', sans-serif; color: darkgray;">00:00</div>
            <div class="extra item" onclick="" data-symbol="-"></div>
            <div class="extra item" onclick="speed_option = 1; applyData();" data-symbol="-">Slow Speed</div>
            <div class="extra item" onclick="speed_option = 2; applyData();" data-symbol="-">Normal Speed</div>
            <div class="extra item" onclick="speed_option = 3; applyData();" data-symbol="-">Fast Speed</div>
        </div>

        <script>
            function mark_evidence(obj) {
                if (obj.dataset.symbol == "-" && found_evidence.length < evidence_amount) { change_visual(obj, "o"); }
                else if (obj.dataset.symbol == "o" || (obj.dataset.symbol == "-")) { change_visual(obj, "x"); }
                else { change_visual(obj, "-"); }
                update();
            }

            function mark_ghost(obj) {
                if (obj.dataset.symbol == "-") { found_ghost = obj.innerHTML; }
                else if (obj.dataset.symbol == "o") { change_visual(obj, "x"); found_ghost = null; }
                else  { change_visual(obj, "-"); }
                update();
            }

            function change_visual(obj, label) {
                obj.dataset.symbol = label;
                obj.classList.remove("state-minus", "state-x", "state-o");
                const thresh = obj.getElementsByTagName("p")[0];
                if (thresh) thresh.style.color = "#e0b255";
                switch (label) {
                    case "-": obj.classList.add("state-minus"); break;
                    case "o": obj.classList.add("state-o");     break;
                    case "x": 
                        obj.classList.add("state-x");
                        if (thresh) thresh.style.color = "gray";
                    break;
                    
                }
            }

            function ruleout(name) {
                const ghosts = document.getElementsByClassName('ghost');
                for (let gIndex = 0; gIndex < ghosts.length; gIndex++)
                    if (ghosts[gIndex].innerHTML.replace(/<p\b[^>]*>.*?<\/p>/gi, "") == name) {
                        ghosts[gIndex].classList.add("state-y");
                        ghosts[gIndex].getElementsByTagName("p")[0].style.color = "gray";
                    }
            }

            function update() {
                const evidence = document.getElementsByClassName('evidence');
                const ghosts = document.getElementsByClassName('ghost');

                crossed_ghosts = [];
                crossed_evidence = [];
                found_evidence = [];    
                
                for (let eIndex = 0; eIndex < evidence.length; eIndex++) {
                    if (evidence[eIndex].dataset.symbol == "x") crossed_evidence.push(evidence[eIndex].innerHTML);
                    if (evidence[eIndex].dataset.symbol == "o") found_evidence.push(evidence[eIndex].innerHTML);
                }

                for (let gIndex = 0; gIndex < ghosts.length; gIndex++) {
                    if (ghosts[gIndex].dataset.symbol == "o" && ghosts[gIndex].innerHTML != found_ghost) change_visual(ghosts[gIndex], "-");  
                    else if (ghosts[gIndex].innerHTML == found_ghost) change_visual(ghosts[gIndex], "o");
                    if (ghosts[gIndex].dataset.symbol == "x") crossed_ghosts.push(ghosts[gIndex].innerHTML);
                }
                applyData();
            }

            function applyData() {
                const extras = document.getElementsByClassName("extra");
                const ghosts = document.getElementsByClassName("ghost");
                for (let gIndex = 0; gIndex < ghosts.length; gIndex++) {
                    let name = ghosts[gIndex].innerHTML.replace(/<p\b[^>]*>.*?<\/p>/gi, "");

                    if (ghost_data[name]) {
                        ghosts[gIndex].classList.remove("state-y");
                        if (ghosts[gIndex].dataset.symbol != "x") ghosts[gIndex].getElementsByTagName("p")[0].style.color = "#e0b255";

                        for (let eIndex = 0; eIndex < found_evidence.length; eIndex++)
                            if (!ghost_data[name].Evidence.includes(found_evidence[eIndex]))
                                if (!(name == "The Mimic" && found_evidence[eIndex] == "Ghost Orbs"))
                                    ruleout(name);

                        for (let eIndex = 0; eIndex < crossed_evidence.length; eIndex++) 
                            if ((evidence_amount == 3 && ghost_data[name].Evidence.includes(crossed_evidence[eIndex]))
                            || crossed_evidence[eIndex].includes(ghost_data[name].Forced)) 
                                ruleout(name);

                        if (found_evidence.length == evidence_amount && 
                            !found_evidence.includes(ghost_data[name].Forced)
                            && ghost_data[name].Forced)
                                if (evidence_amount) ruleout(name);

                        let missing_evidence = 0;
                        for (let eIndex = 0; eIndex < crossed_evidence.length; eIndex++) {
                            if (ghost_data[name].Evidence.includes(crossed_evidence[eIndex]))
                                missing_evidence++;
                        }
                        if (evidence_amount - missing_evidence < 0 && evidence_amount != 0) ruleout(name);
                    }

                }
            
                if (isMale) { 
                    ruleout("Banshee");
                    ruleout("Dayan");  
                    change_visual(extras[0], "-");
                } else change_visual(extras[0], "x");
      
                switch (speed_option) {
                    case 1:
                        if (extras[6].dataset.symbol == "x" && speed_option > 0) { change_visual(extras[6], "-"); speed_option = 0; break; }
                        change_visual(extras[6], "x"); 
                        change_visual(extras[7], "-"); 
                        change_visual(extras[8], "-"); 
                    break;
                    case 2:
                        if (extras[7].dataset.symbol == "x" && speed_option > 0) { change_visual(extras[7], "-"); speed_option = 0; break; }
                        change_visual(extras[6], "-"); 
                        change_visual(extras[7], "x"); 
                        change_visual(extras[8], "-"); 
                    break;
                    case 3:
                        if (extras[8].dataset.symbol == "x" && speed_option > 0) { change_visual(extras[8], "-"); speed_option = 0; break; }
                        change_visual(extras[6], "-"); 
                        change_visual(extras[7], "-"); 
                        change_visual(extras[8], "x"); 
                    break;
                }

                for (let gIndex = 0; gIndex < ghosts.length && speed_option; gIndex++) {
                    let name = ghosts[gIndex].innerHTML.replace(/<p\b[^>]*>.*?<\/p>/gi, "");
                    if (Math.abs(speed_option) == 1 && ghost_data[name].Speed && !ghost_data[name].Speed.includes("Slow Speed")) ruleout(name);
                    else if (Math.abs(speed_option) == 2 && ghost_data[name].Speed && !ghost_data[name].Speed.includes("Normal Speed")) ruleout(name);
                    else if (Math.abs(speed_option) == 3 && ghost_data[name].Speed && !ghost_data[name].Speed.includes("Fast Speed")) ruleout(name);
                }
                speed_option = -1 * Math.abs(speed_option);
            }

            function toggleEvidence() {
                evidence_amount--;
                if (evidence_amount < 0) evidence_amount = 3;
                document.getElementsByClassName("extra")[1].innerHTML = `${evidence_amount} Evidence`;
                update();
            }

            TimeStart.addEventListener("click", () => {
                if (timer_state == "o") { 
                    document.getElementsByClassName("extra")[3].innerHTML = "Stop";
                    timer_state = "x"; 
                    timestamp = Math.floor((new Date()).getTime() / 1000);
                } else if (timer_state == "x") { 
                    document.getElementsByClassName("extra")[3].innerHTML = "Reset"; 
                    timer_state = "-"; 
                } else { 
                    document.getElementsByClassName("extra")[3].innerHTML = "Start"; 
                    timer_state = "o"; 
                }
            });

            setInterval(() => {
                if (timer_value > 6_000_000) timer_value = 6_000_000;
                if (timer_state == "x") timer_value = Math.floor((new Date()).getTime() / 1000) - timestamp;
                else if (timer_state == "o") timer_value = 0;
                document.getElementsByClassName("extra")[4].innerHTML = `${(Math.floor(timer_value / 60)).toString().padStart(2, "0")}:${(timer_value % 60).toString().padStart(2, "0")}`; 
            }, 1000);

            update();
        </script>

    </body>
</html>